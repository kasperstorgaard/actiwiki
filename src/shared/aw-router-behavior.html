<link rel='import' href='../../bower_components/polymer/polymer-element.html'>
<link rel='import' href='../../bower_components/app-route/app-location.html'>
<link rel='import' href='../../bower_components/app-route/app-route.html'>

<script>
  (function () {
    let appLocation;

    window.AwRouterBehavior = (S) => class AwRouterBehavior extends S {
      static get properties() {
        return {
          pattern: String,
          route: {
            type: Object,
            notify: true
          },
          routeData: {
            type: Object,
            notify: true
          },
          subroute: Object,
          _appRoute: Object,
          _appLocation: Object
        };
      }

      static get observers() {
        return [
          '_updatePattern(_appRoute, pattern)'
        ]
      }

      connectedCallback() {
        if (super.connectedCallback) {
          super.connectedCallback();
        }

        this._initAppLocation();
        this._initAppRoute();
      }

      _initAppLocation() {
        if (!appLocation) {
          appLocation = document.createElement('app-location');
          document.body.appendChild(appLocation);
        }

        appLocation.addEventListener('route-changed', () => this._appRoute.route = appLocation.route);
      }

      _initAppRoute() {
        const appRoute = document.createElement('app-route');
        this.appendChild(appRoute);

        appRoute.addEventListener('route-changed', () => appLocation.route = appRoute.route);
        appRoute.addEventListener('tail-changed', () => this.subroute = appRoute.tail);
        appRoute.addEventListener('data-changed', () => this.routeData = appRoute.data);

        appRoute.route = appLocation.route;

        this._appRoute = appRoute;
      }

      _updatePattern(appRoute, pattern) {
        if (appRoute && pattern !== undefined) {
          appRoute.pattern = pattern;
        }
      }
    }
  }());
</script>